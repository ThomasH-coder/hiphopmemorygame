let audioUnlocked=!1;const gameBoard=document.getElementById("game-board"),restartButton=document.getElementById("restart"),timerElement=document.getElementById("timer"),bestTimeElement=document.getElementById("best-time"),leaderboardContainer=document.getElementById("leaderboard"),editionSelect=document.getElementById("edition-select"),loadGameButton=document.getElementById("load-game"),muteButton=document.getElementById("mute-button"),volumeControl=document.getElementById("volume-control"),volumeLabel=document.querySelector(".volume-label"),winModal=document.getElementById("win-modal"),finalTimeElement=document.getElementById("final-time"),playerNameInput=document.getElementById("player-name"),saveScoreButton=document.getElementById("save-score"),closeModalButton=document.getElementById("close-modal");/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&(volumeControl.style.display="none",volumeLabel&&(volumeLabel.style.display="none")),document.addEventListener("click",(()=>{if("undefined"!=typeof AudioContext){const e=new(window.AudioContext||window.webkitAudioContext);"suspended"===e.state&&e.resume()}}),{once:!0});const flipSound=new Audio("sounds/flip.mp3"),matchSound=new Audio("sounds/match.mp3"),winSounds={"80s Rappers":new Audio("sounds/win.mp3"),"90s Rappers":new Audio("sounds/win.mp3"),"2000s Rappers":new Audio("sounds/win.mp3"),"2010s Rappers":new Audio("sounds/win.mp3"),Producers:new Audio("sounds/win.mp3"),"Female Rappers":new Audio("sounds/win.mp3"),"Underground Legends":new Audio("sounds/win.mp3")},editionLoops={"80s Rappers":new Audio("sounds/loops/80s.mp3"),"90s Rappers":new Audio("sounds/loops/90s.mp3"),"2000s Rappers":new Audio("sounds/loops/2000s.mp3"),"2010s Rappers":new Audio("sounds/loops/2010s.mp3"),Producers:new Audio("sounds/loops/producers.mp3"),"Female Rappers":new Audio("sounds/loops/femalerappers.mp3"),"Underground Legends":new Audio("sounds/loops/underground.mp3")};function primeAudio(e){e.volume=0;const t=e.play();void 0!==t&&t.then((()=>{e.pause(),e.currentTime=0})).catch((()=>{}))}Object.values(editionLoops).forEach((e=>{e.loop=!0,e.volume=.3})),primeAudio(flipSound),primeAudio(matchSound),Object.values(winSounds).forEach(primeAudio),Object.values(editionLoops).forEach(primeAudio);let isMuted=!1;function setVolume(e){const t=Math.min(Math.max(parseFloat(e),0),1);flipSound.volume=Math.min(1.5*t,1),matchSound.volume=t,Object.values(winSounds).forEach((e=>e.volume=t)),Object.values(editionLoops).forEach((e=>e.volume=.3*t))}function toggleMute(){isMuted=!isMuted;[flipSound,matchSound,...Object.values(winSounds),...Object.values(editionLoops)].forEach((e=>e.muted=isMuted)),muteButton.textContent=isMuted?"Unmute":"Mute"}function unlockAudio(){if("undefined"!=typeof AudioContext){const e=new(window.AudioContext||window.webkitAudioContext);"suspended"===e.state&&e.resume()}isMuted||setVolume(volumeControl.value),volumeControl.removeEventListener("pointerdown",unlockAudio),volumeControl.removeEventListener("touchstart",unlockAudio),document.removeEventListener("click",unlockAudio)}function fadeOutAudio(e,t=1e3){const n=e.volume/(t/50),o=e.volume,a=setInterval((()=>{e.volume>n?e.volume-=n:(clearInterval(a),e.pause(),e.currentTime=0,e.volume=o)}),50)}volumeControl.addEventListener("input",(()=>{isMuted||setVolume(volumeControl.value)})),muteButton.addEventListener("click",toggleMute),document.addEventListener("click",unlockAudio,{once:!0}),volumeControl.addEventListener("pointerdown",unlockAudio,{once:!0}),volumeControl.addEventListener("touchstart",unlockAudio,{once:!0});let timer=null,seconds=0,flippedCards=[],matchedCards=[],currentEdition="90s Rappers",lastMatchTime=0,comboCount=0;const editionEmojis={"80s Rappers":["ðŸŽ¤","ðŸ“¼","ðŸ•¶ï¸","ðŸŽ§"],"90s Rappers":["ðŸ”¥","ðŸŽ¶","ðŸŽ§","ðŸ’¿"],"2000s Rappers":["ðŸ’¥","ðŸŽ§","ðŸ“±","ðŸŽµ"],"2010s Rappers":["âœ¨","ðŸŽ§","ðŸ“¸","ðŸŽ¤"],Producers:["ðŸŽ›ï¸","ðŸŽšï¸","ðŸŽ§","ðŸ”Š"],"Female Rappers":["ðŸ’…","ðŸŽ¤","ðŸ‘‘","ðŸ’–"],"Underground Legends":["ðŸ§ ","ðŸŽ§","ðŸ•¶ï¸","ðŸ’£"]};function shuffle(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}const editionCache={};async function loadEdition(e){if(editionCache[e])return editionCache[e];const t=await fetch(e),n=await t.json();return editionCache[e]=n,n}function injectSEOContent(e){document.getElementById("seo-content").innerHTML=e.map((e=>`<span>${e.name}</span>`)).join(" ")}async function startGame(e="data/cards-90s.json",t="90s Rappers"){currentEdition=t,Object.values(editionLoops).forEach((e=>e.pause()));const n=editionLoops[currentEdition];!isMuted&&n&&(n.currentTime=0,n.play(),n.volume=.3*volumeControl.value);for(const e in winSounds){const t=winSounds[e];t instanceof Audio&&(!t.paused&&t.currentTime>0?fadeOutAudio(t):(t.pause(),t.currentTime=0))}const o=await loadEdition(e);document.getElementById("edition-title").textContent=o.edition,injectSEOContent(o.cards),gameBoard.innerHTML="",flippedCards=[],matchedCards=[],seconds=0;const a=[...o.cards,...o.cards];shuffle(a),a.forEach((e=>{const t=document.createElement("div");t.classList.add("card"),t.dataset.name=e.id,t.dataset.cardName=e.name,t.setAttribute("tabindex","0"),t.setAttribute("role","button"),t.setAttribute("aria-label",`Card: ${e.name}`);const n=document.createElement("div");n.classList.add("card-inner");const o=document.createElement("div");o.classList.add("card-front");const a=document.createElement("img");a.src=e.image,a.alt=e.name,o.appendChild(a);const d=document.createElement("div");d.classList.add("card-back"),n.appendChild(o),n.appendChild(d),t.appendChild(n),t.ondragstart=e=>e.preventDefault(),t.addEventListener("click",flipCard),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t.click())})),gameBoard.appendChild(t)})),clearInterval(timer),timerElement.textContent="Time: 0s",timer=setInterval(updateTimer,1e3),showBestTime(currentEdition),showLeaderboard(currentEdition)}function flipCard(){flippedCards.length<2&&!this.classList.contains("flipped")&&(isMuted||(flipSound.currentTime=0,flipSound.play()),this.classList.add("flipped"),flippedCards.push(this),2===flippedCards.length&&checkMatch())}function checkMatch(){const[e,t]=flippedCards;if(e.dataset.name===t.dataset.name){isMuted||matchSound.play(),matchedCards.push(e.dataset.name);const t=document.getElementById("match-feedback");t.textContent=`Matched: ${e.dataset.cardName}`,t.style.opacity=1,setTimeout((()=>{t.style.opacity=0}),3e3),flippedCards=[];const n=Date.now();n-lastMatchTime<=1e4?comboCount++:comboCount=1,lastMatchTime=n,comboCount>=2&&triggerComboEffect(comboCount),matchedCards.length===gameBoard.children.length/2&&endGame()}else setTimeout((()=>{e.classList.remove("flipped"),t.classList.remove("flipped"),flippedCards=[]}),1e3)}function updateTimer(){seconds++,timerElement.textContent=`Time: ${seconds}s`}function endGame(){clearInterval(timer),!isMuted&&winSounds[currentEdition]&&(winSounds[currentEdition].currentTime=0,winSounds[currentEdition].play(),launchCanvasConfetti(),launchEmojiBurst(),Object.values(editionLoops).forEach((e=>e.pause()))),finalTimeElement.textContent=`Time: ${seconds}s`,playerNameInput.value="",winModal.classList.remove("hidden")}function updateLeaderboard(e,t,n){const o=`leaderboard_${e}`;let a=JSON.parse(localStorage.getItem(o))||[];a.push({name:n,time:t}),a.sort(((e,t)=>e.time-t.time)),a=a.slice(0,5),localStorage.setItem(o,JSON.stringify(a))}function showLeaderboard(e){const t=`leaderboard_${e}`,n=JSON.parse(localStorage.getItem(t))||[];if(leaderboardContainer.innerHTML=`<h3>${e} Leaderboard</h3>`,0===n.length)leaderboardContainer.innerHTML+="<p>No scores yet.</p>";else{const e=document.createElement("ol");n.forEach((t=>{const n=document.createElement("li");n.textContent=`${t.name} - ${t.time}s`,e.appendChild(n)})),leaderboardContainer.appendChild(e)}}function showBestTime(e){const t=`leaderboard_${e}`,n=JSON.parse(localStorage.getItem(t))||[];bestTimeElement.textContent=n.length>0?`Best Time: ${n[0].time}s`:"Best Time: --"}document.addEventListener("keydown",(e=>{const t=Array.from(gameBoard.querySelectorAll(".card")),n=t.indexOf(document.activeElement);if(-1===n)return;const o=t[0].getBoundingClientRect().width,a=Math.max(1,Math.floor(gameBoard.offsetWidth/o));let d=n;switch(e.key){case"ArrowRight":d=(n+1)%t.length;break;case"ArrowLeft":d=(n-1+t.length)%t.length;break;case"ArrowDown":d=(n+a)%t.length;break;case"ArrowUp":d=(n-a+t.length)%t.length;break;default:return}e.preventDefault(),t[d].focus()}));const isMobile=/Mobi|Android|iPhone|iPad|iPod/i.test(navigator.userAgent);let parallaxX=0,parallaxY=0,parallaxFrameId=null;function updateParallax(e,t){document.querySelectorAll(".layer").forEach(((n,o)=>{n.style.transform=`translate(${e*(o+1)*10}px, ${t*(o+1)*10}px)`}))}function requestParallaxUpdate(){parallaxFrameId||(parallaxFrameId=requestAnimationFrame((()=>{updateParallax(parallaxX,parallaxY),parallaxFrameId=null})))}function triggerComboEffect(e){const t=document.createElement("div");t.className="combo-banner",t.textContent=`ðŸ”¥ Combo x${e}! ðŸ”¥`,document.body.appendChild(t),setTimeout((()=>t.remove()),1500),isMuted||new Audio("sounds/combo.mp3").play(),import("https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js").then((e=>{e({particleCount:150,spread:70,origin:{y:.6}})})).catch((e=>console.error("Confetti failed to load:",e)))}function launchCanvasConfetti(){if("function"!=typeof confetti)return;const e=editionEmojis[currentEdition]||["ðŸŽ‰","âœ¨","ðŸŽ§"];confetti({particleCount:100,spread:170,origin:{y:.6},emojis:e,scalar:1.2,shapes:["emoji"]})}function launchEmojiBurst(e=70){const t=editionEmojis[currentEdition]||["ðŸŽ‰","âœ¨","ðŸŽ§"];for(let n=0;n<e;n++){const e=document.createElement("div");e.className="emoji-burst",e.textContent=t[Math.floor(Math.random()*t.length)],e.style.left=100*Math.random()+"%",e.style.fontSize=`${1.5+Math.random()}rem`,e.style.animationDuration=3+4*Math.random()+"s",document.body.appendChild(e),setTimeout((()=>e.remove()),1e3*parseFloat(e.style.animationDuration))}}isMobile||document.addEventListener("mousemove",(e=>{parallaxX=2*(e.clientX/window.innerWidth-.5),parallaxY=2*(e.clientY/window.innerHeight-.5),requestParallaxUpdate()})),saveScoreButton.addEventListener("click",(()=>{const e=playerNameInput.value.trim()||"Anonymous";updateLeaderboard(currentEdition,seconds,e),showLeaderboard(currentEdition),showBestTime(currentEdition),leaderboardContainer.classList.add("visible"),winModal.classList.add("hidden")})),closeModalButton.addEventListener("click",(()=>winModal.classList.add("hidden"))),loadGameButton.addEventListener("click",(()=>{setVolume(volumeControl.value);startGame(editionSelect.value,editionSelect.options[editionSelect.selectedIndex].dataset.name)})),restartButton.addEventListener("click",(()=>{Object.values(editionLoops).forEach((e=>{e.pause(),e.currentTime=0}));startGame(editionSelect.value,editionSelect.options[editionSelect.selectedIndex].dataset.name)})),gameBoard.addEventListener("dragstart",(e=>e.preventDefault()));